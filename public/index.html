<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Manager API Utilities</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.6;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      color: #333;
    }
    h1 {
      color: #2c3e50;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    pre {
      background-color: #f8f8f8;
      padding: 10px;
      border-radius: 4px;
      overflow: auto;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }
    button:hover {
      background-color: #2980b9;
    }
    input, textarea {
      display: block;
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      box-sizing: border-box;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
    #output {
      background-color: #f8f8f8;
      padding: 10px;
      border-radius: 4px;
      margin-top: 20px;
      white-space: pre-wrap;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h1>Task Manager API Utilities</h1>
  
  <div class="card">
    <h2>Create Task</h2>
    <form id="createTaskForm">
      <div>
        <label for="taskTitle">Task Title:</label>
        <input type="text" id="taskTitle" required>
      </div>
      <div>
        <label for="taskDescription">Description:</label>
        <textarea id="taskDescription" rows="3"></textarea>
      </div>
      <div>
        <label for="boardId">Board ID:</label>
        <input type="text" id="boardId" required>
        <small>Will be automatically cleaned</small>
      </div>
      <div>
        <label for="columnId">Column ID:</label>
        <select id="columnId">
          <option value="todo">To Do</option>
          <option value="in-progress">In Progress</option>
          <option value="done">Done</option>
        </select>
      </div>
      <button type="submit">Create Task</button>
    </form>
  </div>
  
  <div class="card">
    <h2>Clean ObjectId</h2>
    <div>
      <label for="objectId">ObjectId to Clean:</label>
      <input type="text" id="objectId" placeholder="Enter MongoDB ObjectId">
      <button id="cleanIdBtn">Clean ID</button>
    </div>
  </div>
  
  <div class="card">
    <h2>Get Tasks for Board</h2>
    <div>
      <label for="boardIdForTasks">Board ID:</label>
      <input type="text" id="boardIdForTasks" placeholder="Enter Board ID">
      <button id="getTasksBtn">Get Tasks</button>
    </div>
  </div>
  
  <div id="output"></div>
  
  <script src="/js/apiUtils.js"></script>
  <script>
    // Function to show output
    function showOutput(title, data) {
      const outputEl = document.getElementById('output');
      outputEl.innerHTML = `<strong>${title}</strong>\n${JSON.stringify(data, null, 2)}`;
    }
    
    // Handle task creation
    document.getElementById('createTaskForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const taskData = {
        title: document.getElementById('taskTitle').value,
        description: document.getElementById('taskDescription').value,
        boardId: document.getElementById('boardId').value,
        columnId: document.getElementById('columnId').value,
        color: 'blue'
      };
      
      try {
        showOutput('Creating task...', {
          originalBoardId: taskData.boardId,
          cleanedBoardId: TaskManagerUtils.cleanMongoId(taskData.boardId)
        });
        
        const result = await TaskManagerUtils.createTaskSafely(taskData);
        showOutput('Task Creation Result', result);
      } catch (error) {
        showOutput('Error', { message: error.message });
      }
    });
    
    // Handle ObjectId cleaning
    document.getElementById('cleanIdBtn').addEventListener('click', () => {
      const objectId = document.getElementById('objectId').value;
      const cleaned = TaskManagerUtils.cleanMongoId(objectId);
      const isValid = TaskManagerUtils.isValidMongoId(objectId);
      
      showOutput('ObjectId Cleaning', {
        original: objectId,
        cleaned: cleaned,
        isValid: isValid
      });
    });
    
    // Handle getting tasks
    document.getElementById('getTasksBtn').addEventListener('click', async () => {
      const boardId = document.getElementById('boardIdForTasks').value;
      
      try {
        showOutput('Getting tasks...', {
          boardId: boardId,
          cleanedBoardId: TaskManagerUtils.cleanMongoId(boardId)
        });
        
        const tasks = await TaskManagerUtils.getBoardTasksSafely(boardId);
        showOutput('Tasks Result', {
          count: tasks.length,
          tasks: tasks.slice(0, 3) // Show only first 3 for brevity
        });
      } catch (error) {
        showOutput('Error', { message: error.message });
      }
    });
  </script>
</body>
</html> 